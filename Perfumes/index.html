<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Escaner de Productos</title>
    <script src="https://cdn.jsdelivr.net/npm/jsqr@1.4.0/dist/jsQR.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            color: #fff;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
        }
        
        .container {
            width: 100%;
            max-width: 800px;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 20px;
        }
        
        header {
            text-align: center;
            margin-bottom: 20px;
        }
        
        h1 {
            font-size: 2.2rem;
            margin-bottom: 10px;
            background: linear-gradient(90deg, #4cc9f0, #4361ee);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
        }
        
        .subtitle {
            font-size: 1.1rem;
            opacity: 0.8;
        }
        
        .scanner-container {
            position: relative;
            width: 100%;
            max-width: 500px;
            border-radius: 16px;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.4);
            background: rgba(30, 30, 46, 0.7);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        #video {
            width: 100%;
            display: block;
        }
        
        .scan-area {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 70%;
            height: 200px;
            border: 2px solid #4cc9f0;
            border-radius: 10px;
            box-shadow: 0 0 0 1000px rgba(0, 0, 0, 0.5);
        }
        
        .scan-line {
            position: absolute;
            height: 2px;
            width: 100%;
            background: #4cc9f0;
            top: 0;
            animation: scan 2s infinite linear;
            box-shadow: 0 0 10px #4cc9f0;
        }
        
        @keyframes scan {
            0% {
                top: 0;
            }
            50% {
                top: 100%;
            }
            100% {
                top: 0;
            }
        }
        
        .controls {
            display: flex;
            gap: 15px;
            margin-top: 10px;
        }
        
        button {
            padding: 12px 25px;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        #startButton {
            background: linear-gradient(90deg, #4361ee, #3a0ca3);
            color: white;
        }
        
        #stopButton {
            background: linear-gradient(90deg, #f72585, #b5179e);
            color: white;
        }
        
        button:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }
        
        button:active {
            transform: translateY(0);
        }
        
        .result {
            width: 100%;
            max-width: 500px;
            background: rgba(30, 30, 46, 0.7);
            backdrop-filter: blur(10px);
            border-radius: 16px;
            padding: 20px;
            margin-top: 20px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.4);
        }
        
        .result h2 {
            font-size: 1.5rem;
            margin-bottom: 15px;
            color: #4cc9f0;
        }
        
        .product-info {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        
        .product-name {
            font-size: 1.3rem;
            font-weight: bold;
            color: #fff;
        }
        
        .product-details {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }
        
        .detail {
            background: rgba(67, 97, 238, 0.2);
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 0.9rem;
        }
        
        .instructions {
            margin-top: 30px;
            background: rgba(30, 30, 46, 0.7);
            backdrop-filter: blur(10px);
            border-radius: 16px;
            padding: 20px;
            max-width: 500px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .instructions h3 {
            color: #4cc9f0;
            margin-bottom: 10px;
        }
        
        .instructions ol {
            margin-left: 20px;
        }
        
        .instructions li {
            margin-bottom: 8px;
        }
        
        .hidden {
            display: none;
        }
        
        .status {
            margin-top: 10px;
            text-align: center;
            font-style: italic;
            opacity: 0.8;
        }
        
        @media (max-width: 600px) {
            h1 {
                font-size: 1.8rem;
            }
            
            .scan-area {
                width: 80%;
                height: 180px;
            }
            
            button {
                padding: 10px 20px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Escaner de Productos</h1>
            <p class="subtitle">Escanea el código de barras con tu cámara</p>
        </header>
        
        <div class="scanner-container">
            <video id="video" playsinline></video>
            <div class="scan-area">
                <div class="scan-line"></div>
            </div>
        </div>
        
        <div class="controls">
            <button id="startButton">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M12 9C10.343 9 9 10.343 9 12C9 13.657 10.343 15 12 15C13.657 15 15 13.657 15 12C15 10.343 13.657 9 12 9Z" fill="currentColor"/>
                    <path d="M12 5C15.867 5 19 8.133 19 12C19 15.867 15.867 19 12 19C8.133 19 5 15.867 5 12C5 8.133 8.133 5 12 5ZM12 7C9.239 7 7 9.239 7 12C7 14.761 9.239 17 12 17C14.761 17 17 14.761 17 12C17 9.239 14.761 7 12 7Z" fill="currentColor"/>
                    <path d="M12 1C18.075 1 23 5.925 23 12C23 18.075 18.075 23 12 23C5.925 23 1 18.075 1 12C1 5.925 5.925 1 12 1ZM12 3C7.03 3 3 7.03 3 12C3 16.97 7.03 21 12 21C16.97 21 21 16.97 21 12C21 7.03 16.97 3 12 3Z" fill="currentColor"/>
                </svg>
                Iniciar Cámara
            </button>
            <button id="stopButton" class="hidden">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M12 20C16.418 20 20 16.418 20 12C20 7.582 16.418 4 12 4C7.582 4 4 7.582 4 12C4 16.418 7.582 20 12 20ZM12 22C6.477 22 2 17.523 2 12C2 6.477 6.477 2 12 2C17.523 2 22 6.477 22 12C22 17.523 17.523 22 12 22ZM9 9H11V15H9V9ZM13 9H15V15H13V9Z" fill="currentColor"/>
                </svg>
                Detener Cámara
            </button>
        </div>
        
        <div class="status" id="status">Presiona "Iniciar Cámara" para comenzar</div>
        
        <div class="result hidden" id="result">
            <h2>Información del Producto</h2>
            <div class="product-info">
                <div class="product-name" id="productName">-</div>
                <div class="product-details">
                    <div class="detail" id="productCode">Código: -</div>
                    <div class="detail" id="productCategory">Categoría: -</div>
                    <div class="detail" id="productPrice">Precio: -</div>
                </div>
            </div>
        </div>
        
        <div class="instructions">
            <h3>Instrucciones de uso:</h3>
            <ol>
                <li>Haz clic en "Iniciar Cámara" para activar la cámara de tu teléfono.</li>
                <li>Apunta la cámara hacia el código de barras del producto.</li>
                <li>Mantén el código dentro del área de escaneo.</li>
                <li>La información del producto aparecerá automáticamente.</li>
                <li>Usa "Detener Cámara" para desactivar la cámara.</li>
            </ol>
        </div>
    </div>

    <script>
        // Elementos DOM
        const video = document.getElementById('video');
        const startButton = document.getElementById('startButton');
        const stopButton = document.getElementById('stopButton');
        const statusElement = document.getElementById('status');
        const resultElement = document.getElementById('result');
        const productNameElement = document.getElementById('productName');
        const productCodeElement = document.getElementById('productCode');
        const productCategoryElement = document.getElementById('productCategory');
        const productPriceElement = document.getElementById('productPrice');
        
        // Variables de estado
        let stream = null;
        let scanning = false;
        let canvasElement = document.createElement('canvas');
        let canvasContext = canvasElement.getContext('2d');
        
        // Base de datos simulada de productos
        const productDatabase = {
            '123456789012': { name: 'Leche Entera 1L', category: 'Lácteos', price: '$1.50' },
            '234567890123': { name: 'Pan Integral', category: 'Panadería', price: '$2.00' },
            '345678901234': { name: 'Arroz Blanco 1kg', category: 'Granos', price: '$1.20' },
            '456789012345': { name: 'Aceite de Oliva 500ml', category: 'Aceites', price: '$5.50' },
            '567890123456': { name: 'Jabón Líquido', category: 'Limpieza', price: '$3.25' },
            '678901234567': { name: 'Cereal de Maíz', category: 'Cereales', price: '$2.75' },
            '789012345678': { name: 'Yogur Natural', category: 'Lácteos', price: '$1.80' },
            '890123456789': { name: 'Pasta Spaghetti', category: 'Pastas', price: '$1.60' },
            '901234567890': { name: 'Atún en Lata', category: 'Conservas', price: '$2.40' },
            '012345678901': { name: 'Galletas de Avena', category: 'Galletas', price: '$2.10' }
        };
        
        // Iniciar la cámara
        startButton.addEventListener('click', async () => {
            try {
                statusElement.textContent = 'Iniciando cámara...';
                
                // Solicitar acceso a la cámara
                stream = await navigator.mediaDevices.getUserMedia({ 
                    video: { 
                        facingMode: 'environment', // Usar cámara trasera en móviles
                        width: { ideal: 1280 },
                        height: { ideal: 720 }
                    } 
                });
                
                video.srcObject = stream;
                video.setAttribute('playsinline', true); // Importante para iOS
                await video.play();
                
                // Actualizar interfaz
                startButton.classList.add('hidden');
                stopButton.classList.remove('hidden');
                statusElement.textContent = 'Cámara activa - Escaneando...';
                
                // Iniciar el escaneo
                scanning = true;
                scanFrame();
                
            } catch (err) {
                console.error('Error al acceder a la cámara:', err);
                statusElement.textContent = 'Error: No se pudo acceder a la cámara. Asegúrate de permitir el acceso.';
            }
        });
        
        // Detener la cámara
        stopButton.addEventListener('click', () => {
            if (stream) {
                stream.getTracks().forEach(track => track.stop());
                stream = null;
            }
            
            scanning = false;
            video.srcObject = null;
            
            // Actualizar interfaz
            stopButton.classList.add('hidden');
            startButton.classList.remove('hidden');
            statusElement.textContent = 'Cámara detenida';
        });
        
        // Función para escanear cada frame
        function scanFrame() {
            if (!scanning) return;
            
            if (video.readyState === video.HAVE_ENOUGH_DATA) {
                // Configurar canvas con las dimensiones del video
                canvasElement.width = video.videoWidth;
                canvasElement.height = video.videoHeight;
                
                // Dibujar el frame actual en el canvas
                canvasContext.drawImage(video, 0, 0, canvasElement.width, canvasElement.height);
                
                // Obtener los datos de la imagen
                const imageData = canvasContext.getImageData(0, 0, canvasElement.width, canvasElement.height);
                
                // Intentar decodificar códigos QR
                const code = jsQR(imageData.data, imageData.width, imageData.height, {
                    inversionAttempts: 'dontInvert',
                });
                
                // Si se encuentra un código
                if (code) {
                    const codeData = code.data;
                    lookUpProduct(codeData);
                }
            }
            
            // Continuar escaneando
            requestAnimationFrame(scanFrame);
        }
        
        // Buscar producto en la base de datos
        function lookUpProduct(code) {
            // Simular búsqueda en base de datos
            const product = productDatabase[code];
            
            if (product) {
                // Mostrar información del producto
                productNameElement.textContent = product.name;
                productCodeElement.textContent = `Código: ${code}`;
                productCategoryElement.textContent = `Categoría: ${product.category}`;
                productPriceElement.textContent = `Precio: ${product.price}`;
                
                resultElement.classList.remove('hidden');
                statusElement.textContent = 'Producto identificado correctamente';
                
                // Detener el escaneo después de encontrar un producto
                setTimeout(() => {
                    if (stream) {
                        stream.getTracks().forEach(track => track.stop());
                        stream = null;
                    }
                    
                    scanning = false;
                    video.srcObject = null;
                    
                    stopButton.classList.add('hidden');
                    startButton.classList.remove('hidden');
                    statusElement.textContent = 'Escaneo completado - Presiona "Iniciar Cámara" para escanear otro producto';
                }, 3000);
                
            } else {
                // Producto no encontrado
                productNameElement.textContent = 'Producto no encontrado';
                productCodeElement.textContent = `Código: ${code}`;
                productCategoryElement.textContent = 'Categoría: -';
                productPriceElement.textContent = 'Precio: -';
                
                resultElement.classList.remove('hidden');
                statusElement.textContent = 'Producto no encontrado en la base de datos';
            }
        }
        
        // Simular escaneo para demostración (sin cámara)
        document.addEventListener('keydown', (e) => {
            if (e.key === 's' || e.key === 'S') {
                // Simular escaneo de un código
                const codes = Object.keys(productDatabase);
                const randomCode = codes[Math.floor(Math.random() * codes.length)];
                lookUpProduct(randomCode);
            }
        });
    </script>
</body>
</html>